{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "schemas/operators/operator_call_base.v1.json",
  "title": "Operator Call Envelope (v1)",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema_version", "payload", "idempotency_key", "auth_context", "trace_context"],
  "properties": {
    "schema_version": { "const": "1.0" },
    "payload": { "type": "object" },
    "idempotency_key": { "type": "string", "minLength": 1 },
    "auth_context": {
      "type": "object",
      "additionalProperties": false,
      "required": ["tenant_id", "principal", "scopes"],
      "properties": {
        "tenant_id": { "$ref": "../common/defs.v1.json#/$defs/TenantId" },
        "principal": { "$ref": "../common/defs.v1.json#/$defs/Principal" },
        "scopes": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "default": []
        }
      }
    },
    "trace_context": {
      "type": "object",
      "additionalProperties": false,
      "required": ["correlation_id", "workflow_id", "step_id"],
      "properties": {
        "correlation_id": { "$ref": "../common/defs.v1.json#/$defs/Uuid" },
        "workflow_id": { "$ref": "../common/defs.v1.json#/$defs/Uuid" },
        "plan_id": { "$ref": "../common/defs.v1.json#/$defs/Uuid" },
        "step_id": { "type": "string", "minLength": 1 },
        "job_id": { "$ref": "../common/defs.v1.json#/$defs/Uuid" }
      }
    },
    "policy_snapshot": { "type": "object" }
  }
}

