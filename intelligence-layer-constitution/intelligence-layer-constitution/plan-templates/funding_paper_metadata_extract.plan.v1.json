{
  "schema_version": "1.0",
  "plan_template_id": "Funding.Paper.Metadata.Extract@1.0.0",
  "intent_type": "Funding.Paper.Metadata.Extract",
  "plan_version": "planner-1.0",
  "description": "Extract paper metadata from URL/PDF/manual input, propose platform request field updates, and request approval to apply.",
  "steps": [
    {
      "step_id": "s1",
      "kind": "operator",
      "name": "Platform.Context.Load",
      "operator_name": "Platform.Context.Load",
      "operator_version": "1.0.0",
      "effects": ["read_only"],
      "policy_tags": ["read_only", "platform_read"],
      "risk_level": "low",
      "cache_policy": "ttl_only",
      "idempotency_template": "platform_context:{tenant_id}:{thread_id}",
      "payload": { "thread_id": { "from": "intent.thread_id" } },
      "produces": ["context.platform"]
    },
    {
      "step_id": "s2",
      "kind": "policy_check",
      "name": "Ensure.Paper.Source",
      "effects": ["read_only"],
      "policy_tags": ["requires_input"],
      "risk_level": "low",
      "cache_policy": "never",
      "check": {
        "check_name": "EnsurePaperSourcePresent",
        "params": {
          "source_ref": "intent.inputs.source",
          "on_missing_action_type": "upload_required"
        }
      }
    },
    {
      "step_id": "s3",
      "kind": "operator",
      "name": "Paper.Metadata.Extract",
      "operator_name": "Paper.Metadata.Extract",
      "operator_version": "1.0.0",
      "effects": ["produce_outcome"],
      "policy_tags": ["draft_only", "public_web"],
      "risk_level": "low",
      "cache_policy": "use_if_safe",
      "idempotency_template": "paper_meta:{tenant_id}:{thread_id}:{computed.source_hash}:{computed.target_fields_hash}",
      "payload": {
        "source": { "from": "intent.inputs.source" },
        "target_fields": { "from": "intent.inputs.target_fields" }
      },
      "produces": ["outcome.paper_metadata"]
    },
    {
      "step_id": "s4",
      "kind": "operator",
      "name": "FundingRequest.Fields.Update.Propose",
      "operator_name": "FundingRequest.Fields.Update.Propose",
      "operator_version": "1.0.0",
      "effects": ["produce_outcome"],
      "policy_tags": ["apply_proposal", "platform_write"],
      "risk_level": "medium",
      "cache_policy": "never",
      "idempotency_template": "patch_proposal:{tenant_id}:{context.platform.funding_request.id}:{outcome.paper_metadata.hash.value}",
      "payload": {
        "funding_request_id": { "from": "context.platform.funding_request.id" },
        "fields": { "from": "outcome.paper_metadata.fields" },
        "human_summary": { "const": "Update funding request paper metadata (title/year/journal/abstract)." }
      },
      "produces": ["outcome.platform_patch_proposal"]
    },
    {
      "step_id": "s5",
      "kind": "human_gate",
      "name": "Apply.PlatformPatch",
      "effects": ["db_write_platform"],
      "policy_tags": ["apply", "platform_write"],
      "risk_level": "medium",
      "cache_policy": "never",
      "gate": {
        "gate_type": "apply_platform_patch",
        "reason_code": "REQUIRES_APPROVAL",
        "title": "Apply funding request updates",
        "description": "Apply the extracted paper metadata to your funding request.",
        "requires_user_input": false,
        "ui_hints": { "primary_button": "Apply changes", "secondary_button": "Cancel" },
        "target_outcome_ref": { "from": "outcome.platform_patch_proposal" }
      }
    }
  ]
}
